<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8">
<title>DomarDashboard – Matcher per datum</title>
<style>
  body { font-family: Arial; margin: 20px; background: #f7f8fa; }
  .card {
    background: white; padding: 15px; margin-bottom: 20px;
    border-radius: 10px; box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  }
  .match {
    padding: 12px; margin-top: 12px; border-bottom: 1px solid #ddd;
  }
  .roles span {
    display: inline-block;
    padding: 3px 8px;
    margin: 2px;
    border-radius: 5px;
    color: white;
    font-size: 12px;
  }
  .D1 { background: #1e40af; }
  .HD { background: #3b82f6; }
  .AD1 { background: #f59e0b; }
  .AD2 { background: #f97316; }
  .D2 { background: #8b5cf6; }
  .D3, ._3D { background: #6366f1; }
  .D4, ._4D { background: #4b5563; }
  .Other { background: #9ca3af; }
</style>
</head>

<body>

<h2>DomarDashboard – Matcher per datum</h2>

<div class="card">
  <label>Välj datum: </label>
  <input id="dateInput" type="date">
  <button onclick="loadMatches()">Ladda matcher</button>
</div>

<div id="output"></div>

<script>
function mapRole(desc) {
  if (!desc) return "Other";

  let d = desc.toLowerCase().trim();

  // SPECIFIKA ROLLER (måste komma först!)

  if (d.includes("förstedomare")) return "D1";
  if (d.includes("andredomare")) return "D2";
  if (d.includes("tredjedomare")) return "D3";
  if (d.includes("fjärdedomare")) return "D4";

  if (d.includes("ass. domare 1") || d.includes("ass.domare 1")) return "AD1";
  if (d.includes("ass. domare 2") || d.includes("ass.domare 2")) return "AD2";

  // VANLIG DOMARE (ska bara träffa exakt på ordet "Domare")
  if (d === "domare") return "HD";

  return "Other";
}


async function loadMatches() {
  const d = document.getElementById("dateInput").value;
  if (!d) return alert("Välj ett datum.");

  //const url = `https://www.gbgfotboll.se/api/matches-today/games/?showReferees=true&associationId=7&date=${d}`;

const url =
  "https://corsproxy.io/?" +
  encodeURIComponent(`https://www.gbgfotboll.se/api/matches-today/games/?showReferees=true&associationId=7&date=${d}`);


  const res = await fetch(url);
  const data = await res.json();

  const out = document.getElementById("output");
  out.innerHTML = "";

  for (const comp of data.competitions) {
    const compBox = document.createElement("div");
    compBox.className = "card";

    compBox.innerHTML = `<h3>${comp.name}</h3>`;

    for (const g of comp.games) {
      let refs = g.referees.map(r => {
        const role = mapRole(r.roleDescription);
        return `<span class="${role}">${role}: ${r.name}</span>`;
      }).join("");

      compBox.innerHTML += `
        <div class="match">
          <b>${g.homeTeam.name}</b> – <b>${g.awayTeam.name}</b><br>
          <small>${g.dateFormatted}, ${g.location}</small>
          <div class="roles">${refs}</div>
        </div>
      `;
    }

    out.appendChild(compBox);
  }
}
</script>

</body>
</html>
